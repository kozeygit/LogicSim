#:kivy 2.0
#:import Factory kivy.factory.Factory

<ConnectionLine>:
    canvas:
        Color:
            rgba: self.color_state

<ActionButton>:
    font_size:15
    color: 1,1,1,1
    background_normal: ''
    background_color: 0.4,0.4,0.4,1

<GateButton@Button>:
    size_hint: None, None
    center: self.parent.center

<ToolToggleButton@ToggleButton>:
    font_size: 15
    size_hint_y: None
    size: 100,100
    pos_hint: {"center_x":0.5}
    allow_no_selection: False

<ToolButton@Button>:
    font_size: 15
    size_hint_y: None
    size: 100,100
    pos_hint: {"center_x":0.5}

<GateLabel@Label>:
    font_size: 25
    color: 0,0,0,1

<ExitPopup>:
    auto_dismiss: True
    title_color: 0,0,0,1
    title_size: 18
    title: "Are you sure you want to quit?\nAny unsaved progress will be lost"
    size_hint: None, None
    size: 350,150
    BoxLayout:
        Button:
            text: 'Cancel'
            on_release: root.dismiss()
        Button:
            text: 'Quit'
            on_release: root.close_window()

<TruthPopup>:
    auto_dismiss: True
    title_color: 0,0,0,1
    title_size: 18
    title: "Truth Table Generator"
    size_hint: 0.6, 0.8
    BoxLayout:
        orientation: "vertical"
        ScrollView:
            size_hint: 1, 0.6
            do_scroll_x: False
            effect_cls: "ScrollEffect"
            Label:
                id: truth_label
                size_hint_y: None
                text_size: self.width, None
                height: self.texture_size[1]
                halign: "center"
                bold: True
                font_name: root.FONT
                color: (0,0,0,1)
                text: "YOOOOOOO"
        GridLayout:
            size_hint: 1, None
            height: 50
            rows: 1
            columns: 3
            TextInput:
                id: truth_input
                text: "Enter Boolean Expression"
                size_hint: 1, 1
                multiline: False
                on_text_validate: root.generate()
            Button:
                text: 'Cancel'
                on_release: root.dismiss()
                size_hint: None, 1
                width: 100
            Button:
                text: 'Generate' 
                on_release: root.generate()
                size_hint: None, 1
                width: 100


<GridLayout>:
    padding: 2
    spacing: 2
    canvas.before:
        Color:
            rgba: (0.8,0.8,0.8,1)
        Rectangle:
            pos: self.pos
            size: self.size

<MainWindow>:

    GridLayout:
        size: root.width, root.height
        rows:2
        orientation: "tb-lr"
        ActionBar:
            height: 30
            pos_hint: {"top":1}
            ActionView:
                spacing: 2
                padding: 2
                ActionPrevious:
                    with_previous: False
                    font_size: 40
                    markup: True
                    title: " [b]Logic Gate Simulator[/b]"
                    app_icon: ""
                ActionButton:
                    text: "Truth Table"
                    on_release: Factory.TruthPopup().open(root)
                ActionButton:
                    text: "Save"
                ActionButton:
                    text: "Load"
                ActionButton:
                    text: "Help"
                ActionButton:
                    text: "Quit"
                    on_release: Factory.ExitPopup().open()
                
        
        GridLayout:
            size: self.parent.width, self.parent.height
            orientation: "tb-rl"
            cols: 3
            padding: 0
            GridLayout:
                orientation: "tb-lr"
                cols:1
                size_hint: None, 1
                width: 100
                ToolToggleButton:
                    id: connectToggle
                    group: "tools"
                    text: "Connect"
                    on_press: root.set_tool("connect")
                ToolToggleButton:
                    id: disconnectToggle
                    group: "tools"
                    text: "Disconnect"
                    on_press: root.set_tool("disconnect")
                ToolToggleButton:
                    id: moveToggle
                    state: "down"
                    group: "tools"
                    text: "Move"
                    on_press: root.set_tool("move")
                ToolButton:
                    text: "Delete"
                    on_press: root.delete_gate()
                ToolButton:
                    text: "Clear"
                    on_press: root.clear_canvas()
                Label:
                    id: toolLabel
                    color: 0,0,0,1
                    text: gateCanvas.tool
            GateCanvas:
                id: gateCanvas
                canvas.before:
                    Color:
                        rgba: (0.1,0.6,0.6,1)
                    Rectangle:
                        pos: map(lambda x: x+5, self.pos)
                        size: map(lambda x: x-10, self.size)
                canvas.after:
                    Color:
                        rgba: (1,0,0,1)
                    Line:
                        width: 4
                        rectangle: (self.x+2, self.y+2, self.width-4, self.height-4)
            ScrollView:
                size_hint: None, 1
                width: 200
                effect_cls: "ScrollEffect"
                GridLayout:
                    size_hint_y: None
                    height: 900
                    cols: 1
                    rows: 2
                    Label:
                        size_hint: 1,0.1
                        markup: True
                        font_size: 40
                        color: 0,0,0,1
                        text: "[b]Gates[/b]"
                    GridLayout:
                        cols: 2
                        spaceing: 1
                        padding: 1
                        size: self.parent.size
                        
                        GateLabel:
                            text: "And"
                        GateButton:
                            id: And
                            on_press: root.add_gate("and")

                            Image:
                                source: 'Images/GateIcons/and.png'
                                width: self.parent.width * 0.9
                                height: self.parent.height * 0.9
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                        
                        GateLabel:
                            text: "Or"
                        GateButton:
                            id: Or
                            on_press: root.add_gate("or")

                            Image:
                                source: 'Images/GateIcons/or.png'
                                width: self.parent.width * 0.9
                                height: self.parent.height * 0.9
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                        
                        GateLabel:
                            text: "Not"
                        GateButton:
                            id: Not
                            on_press: root.add_gate("not")

                            Image:
                                source: 'Images/GateIcons/not.png'
                                width: self.parent.width * 0.9
                                height: self.parent.height * 0.9
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                        
                        GateLabel:
                            text: "Xor"
                        GateButton:
                            id: Xor
                            on_press: root.add_gate("xor")

                            Image:
                                source: 'Images/GateIcons/xor.png'
                                width: self.parent.width * 0.9
                                height: self.parent.height * 0.9
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                        
                        GateLabel:
                            text: "Switch"
                        GateButton:
                            id: Input
                            on_press: root.add_gate("switch")
                            
                            Image:
                                source: 'Images/GateIcons/switch_menu.png'
                                width: self.parent.width * 0.9
                                height: self.parent.height * 0.9
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                        
                        GateLabel:
                            text: "Output"
                        GateButton:
                            id: Output
                            on_press: root.add_gate("output")

                            Image:
                                source: 'Images/GateIcons/output_menu.png'
                                width: self.parent.width * 0.9
                                height: self.parent.height * 0.9
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                        
                        GateLabel:
                            text: "Clock"
                        GateButton:
                            id: Clock
                            on_press: root.add_gate("clock")

                            Image:
                                source: 'Images/GateIcons/clock_menu.png'
                                width: self.parent.width * 0.9
                                height: self.parent.height * 0.9
                                center_x: self.parent.center_x
                                center_y: self.parent.center_y
                